---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import BaseLayout from "../layouts/BaseLayout.astro";
import Container from "../components/Container.astro";
import ArticleListItem from "../components/ArticleListItem.astro";
import removeMarkdown from "../utils/vendors/markdown-to-text";
import type { CollectionEntry } from "astro:content";

interface Props {
    data: CollectionEntry<"blog">[];
    currentPage: number;
    lastPage: number;
    largeBanner?: boolean;
    currentPageTitle?: string;
}

const { data, currentPage, lastPage, largeBanner = false, currentPageTitle } = Astro.props;
const pageTitle = `标签：${Astro.props.currentPageTitle ?? SITE_TITLE}`;
---

<BaseLayout title={pageTitle}>
    <BaseHead slot="head" title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <Header largeBanner={largeBanner} currentPageTitle={currentPageTitle} />
    <Container defaultPadding={true}>
        {/* 添加标签标题栏 */}
        {currentPageTitle && (
            <div class="mb-10 md:mb-16 animate-fade-in-left">
                <div class="flex items-start gap-3">
                    <svg
                        class="w-8 h-8 text-blue-500 flex-shrink-0 mt-0.5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z">
                        </path>
                    </svg>
                    <div class="flex flex-col">
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                            {currentPageTitle}
                        </h1>
                        <span class="text-base text-gray-500 dark:text-gray-400 mt-1">
                            共 {data.length} 篇文章
                        </span>
                    </div>
                </div>
            </div>
        )}

        {/* 重点修改这里：使用 flex flex-col 和 gap-y 类 */}
        <div class="flex flex-col gap-8 mt-10 md:mt-16">
            {
                data.map(post => {
                    let excerpt = post.data.description ?? "";

                    return (
                        <ArticleListItem
                            title={post.data.title}
                            url={`./post/${post.slug}/`}
                            date={post.data.pubDate}
                            tags={post.data.tags ?? []}
                            heroImage={post.data.heroImage}
                            body={post.body}
                        >
                            {excerpt}
                        </ArticleListItem>
                    );
                })
            }
        </div>
        <div class="flex justify-between mt-8 h-12 relative">
            {
                currentPage > 1 ? (
                    <a
                        href={`./blog/${currentPage - 1}`}
                        class="rounded-full bg-primary-700 px-6 py-3 text-base
                        font-semibold text-white shadow-sm hover:bg-primary-500 transition-colors
                        focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
                    >
                        上一页
                    </a>
                ) : (
                    <div aria-hidden="true" />
                )
            }
            <div class="text-black dark:text-white absolute -translate-x-2/4 -translate-y-2/4 left-2/4 top-2/4">
                {currentPage} / {lastPage}
            </div>
            {
                currentPage < lastPage ? (
                    <a
                        href={`./blog/${currentPage + 1}`}
                        class="rounded-full bg-primary-700 px-6 py-3 text-base
                        font-semibold text-white shadow-sm hover:bg-primary-500 transition-colors
                        focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
                    >
                        下一页
                    </a>
                ) : (
                    <div aria-hidden="true" />
                )
            }
        </div>
    </Container>
    <Footer />
</BaseLayout>

<style>
/* 标签标题栏动画 */
@keyframes fade-in-left {
    from {
        opacity: 0;
        transform: translateX(-20px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.animate-fade-in-left {
    animation: fade-in-left 0.6s ease-out;
}
</style>
